<div class="hdr">
  <div></div>
  <div>
    <h2>{{ titulo() }}</h2>
    <div class="sub">Afiliado : <b>{{ afiliadoNombre() || '—' }}</b></div>
  </div>
  <div></div>
</div>

<div *ngIf="loading()" class="st">Cargando…</div>
<div *ngIf="!loading() && errorMsg()" class="st st--err">{{ errorMsg() }}</div>

<form *ngIf="!loading()" [formGroup]="form" (ngSubmit)="save()" class="frm">
  <div class="grid">
    <!-- Parentesco -->
    <div class="col">
      <label>Parentesco</label>
      <select formControlName="codigo_parentesco">
        <option value="">-- Seleccione --</option>
        <option *ngFor="let p of parentescos()" [value]="p.codigo">
          {{ p.codigo }} - {{ p.nombre }}
        </option>
      </select>
    </div>

    <!-- Nombre -->
    <div class="col col-2">
      <label>Nombre *</label>
      <input type="text" formControlName="nombre_datos_familiar" maxlength="100" />
      <div class="err" *ngIf="form.controls['nombre_datos_familiar'].touched && form.controls['nombre_datos_familiar'].invalid">
        Obligatorio (máx. 100).
      </div>
    </div>

    <!-- Documento -->
    <div class="col">
      <label>Documento</label>
      <input type="text" formControlName="documento_datos_familiar" maxlength="20" />
      <div class="err" *ngIf="form.controls['documento_datos_familiar'].touched && form.controls['documento_datos_familiar'].invalid">
        Solo números (máx. 20).
      </div>
    </div>

    <!-- Fecha nacimiento -->
    <div class="col">
      <label>Fecha nacimiento</label>
      <input type="date" formControlName="fecha_nacimiento" />
    </div>

    <!-- Teléfono -->
    <div class="col">
      <label>Teléfono (7 dígitos)</label>
      <input type="text" formControlName="telefono_datos_familiar" placeholder="#######" />
      <div class="err" *ngIf="form.controls['telefono_datos_familiar'].touched && form.controls['telefono_datos_familiar'].invalid">
        Debe tener 7 dígitos.
      </div>
    </div>

    <!-- Celular -->
    <div class="col">
      <label>Celular (10 dígitos)</label>
      <input type="text" formControlName="celular_datos_familiar" placeholder="##########" />
      <div class="err" *ngIf="form.controls['celular_datos_familiar'].touched && form.controls['celular_datos_familiar'].invalid">
        Debe tener 10 dígitos.
      </div>
    </div>

    <!-- Dirección -->
    <div class="col col-2">
      <label>Dirección *</label>
      <input type="text" formControlName="direccion_datos_familiar" maxlength="100" />
      <div class="err" *ngIf="form.controls['direccion_datos_familiar'].touched && form.controls['direccion_datos_familiar'].invalid">
        Obligatorio (máx. 100).
      </div>
    </div>

    <!-- Depto/Ciudad -->
    <app-depto-ciudad
      [deptoCtrl]="depCtrl"
      [ciudadCtrl]="ciuCtrl">
    </app-depto-ciudad>

    <!-- Errores obligatorios de Depto/Ciudad -->
    <div class="col col-2">
      <small class="err" *ngIf="depCtrl.touched && depCtrl.invalid">Departamento requerido.</small>
      <small class="err" *ngIf="ciuCtrl.touched && ciuCtrl.invalid" style="margin-left:12px">Ciudad requerida.</small>
    </div>

    <div class="break"></div>

    <!-- Ingresos / Egresos -->
    <div class="col">
      <label>Ingresos</label>
      <input type="text" inputmode="decimal" class="num-right no-spin"
             [value]="moneyDisplay('ingresos_datos_familiar')"
             (focus)="moneyFocus('ingresos_datos_familiar')"
             (input)="onMoneyInput('ingresos_datos_familiar', $event)"
             (blur)="moneyBlur('ingresos_datos_familiar')" />
    </div>

    <div class="col">
      <label>Egresos</label>
      <input type="text" inputmode="decimal" class="num-right no-spin"
             [value]="moneyDisplay('egresos_datos_familiar')"
             (focus)="moneyFocus('egresos_datos_familiar')"
             (input)="onMoneyInput('egresos_datos_familiar', $event)"
             (blur)="moneyBlur('egresos_datos_familiar')" />
    </div>

    <!-- ¿Referencia? -->
    <div class="col chk">
      <label>
        <input type="checkbox" formControlName="referencia_familiar" />
        ¿Es referencia?
      </label>
    </div>
  </div>

  <div class="actions">
    <button type="submit" class="btn btn--primary" [disabled]="guardando()">
      {{ id() ? 'Guardar' : 'Crear' }}
    </button>
    <button type="button" class="btn ghost" (click)="goBack()" [disabled]="guardando()">Cancelar</button>
  </div>
</form>
