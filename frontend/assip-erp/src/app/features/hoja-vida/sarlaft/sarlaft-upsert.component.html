<div class="hdr">
  <div></div>
  <div>
    <h2>{{ titulo() }}</h2>
    <div class="sub">Afiliado : <b>{{ afiliadoNombre() || '—' }}</b></div>
  </div>
  <div></div>
</div>

<div *ngIf="loading()" class="st">Cargando…</div>
<div *ngIf="!loading() && errorMsg()" class="st st--err">{{ errorMsg() }}</div>

<form *ngIf="!loading()" #frm="ngForm" (ngSubmit)="save(frm)" class="frm" novalidate>
  <div class="grid">

    <!-- ====== Exoneración UIAF ====== -->
    <div class="break"></div>

    <div class="col col-2 check">
      <label>
        <input type="checkbox"
               name="exoneracionUiaf"
               [(ngModel)]="view().exoneracionUiaf"
               (change)="onToggle('exoneracionUiaf', $event)" />
        Exonerado de transacciones en efectivo
      </label>
    </div>

    <!-- Solo si exoneracionUiaf = true -->
    <ng-container *ngIf="view().exoneracionUiaf">
      <div class="col">
        <label>Fecha exoneración *</label>
        <input type="date"
               name="fechaExoneracion"
               [(ngModel)]="view().fechaExoneracion"
               [required]="true" />
      </div>
    </ng-container>

    <!-- ====== Asociado PEP ====== -->
    <div class="break"></div>

    <div class="col col-2 check">
      <label>
        <input type="checkbox"
               name="asociadoPeps"
               [(ngModel)]="view().asociadoPeps"
               (change)="onToggle('asociadoPeps', $event)" />
        El asociado es PEP
      </label>
    </div>

    <!-- Solo si asociadoPeps = true -->
    <ng-container *ngIf="view().asociadoPeps">
      <div class="col">
        <label>Tipo PEP (asociado) *</label>
        <select name="tipoPeps"
                [(ngModel)]="view().tipoPeps"
                [required]="true">
          <option value="">-- Seleccione --</option>
          <option *ngFor="let t of tiposPeps()" [value]="t.codigo">
            {{ t.codigo }} - {{ t.nombre }}
          </option>
        </select>
      </div>

      <div class="col col-2">
        <label>Observaciones *</label>
        <input type="text"
               name="observacionesPeps"
               [(ngModel)]="view().observacionesPeps"
               [required]="true"
               maxlength="300" />
      </div>

      <div class="col">
        <label>Fecha inicio *</label>
        <input type="date"
               name="fechaInicialPeps"
               [(ngModel)]="view().fechaInicialPeps"
               [required]="true" />
      </div>

      <div class="col">
        <label>Fecha fin *</label>
        <input type="date"
               name="fechaFinalPeps"
               [(ngModel)]="view().fechaFinalPeps"
               [required]="true" />
      </div>
    </ng-container>

    <!-- ====== Familiar PEP ====== -->
    <div class="break"></div>

    <div class="col col-2 check">
      <label>
        <input type="checkbox"
               name="familiaPeps"
               [(ngModel)]="view().familiaPeps"
               (change)="onToggle('familiaPeps', $event)" />
        El asociado tiene familiar PEP
      </label>
    </div>

    <!-- Solo si familiaPeps = true -->
    <ng-container *ngIf="view().familiaPeps">
      <div class="col">
        <label>Tipo PEP (familiar) *</label>
        <select name="tipoFamiliaPeps"
                [(ngModel)]="view().tipoFamiliaPeps"
                [required]="true">
          <option value="">-- Seleccione --</option>
          <option *ngFor="let t of tiposPeps()" [value]="t.codigo">
            {{ t.codigo }} - {{ t.nombre }}
          </option>
        </select>
      </div>

      <div class="col">
        <label>Cédula familiar *</label>
        <input type="text"
               name="cedulaFamiliaPeps"
               [(ngModel)]="view().cedulaFamiliaPeps"
               [required]="true"
               maxlength="20" />
      </div>

      <div class="col col-2">
        <label>Nombre familiar *</label>
        <input type="text"
               name="nombreFamiliaPeps"
               [(ngModel)]="view().nombreFamiliaPeps"
               [required]="true"
               maxlength="100" />
      </div>

      <div class="col">
        <label>Parentesco *</label>
        <select
          name="codigoParentesco"
          [(ngModel)]="view().codigoParentesco"
          [required]="true">
          <option value="">-- Seleccione --</option>
          <option *ngFor="let p of parentescos()" [value]="p.codigo">
            {{ p.codigo }} - {{ p.nombre }}
          </option>
        </select>
      </div>
    </ng-container>

    <!-- ====== Negocios en Moneda Extranjera ====== -->
    <div class="break"></div>

    <div class="col col-2 check">
      <label>
        <input type="checkbox"
               name="monedaExtranjera"
               [(ngModel)]="view().monedaExtranjera"
               (change)="onToggle('monedaExtranjera', $event)" />
        Negocios en moneda extranjera
      </label>
    </div>

    <!-- Solo si monedaExtranjera = true -->
    <ng-container *ngIf="view().monedaExtranjera">
      <div class="col col-2">
        <label>Observación *</label>
        <input type="text"
               name="observacionMonedaExtranjera"
               [(ngModel)]="view().observacionMonedaExtranjera"
               [required]="true"
               maxlength="200" />
      </div>
    </ng-container>

    <!-- ====== Cuentas en el Extranjero ====== -->
    <div class="break"></div>

    <div class="col col-2 check">
      <label>
        <input type="checkbox"
               name="cuentaExtranjero"
               [(ngModel)]="view().cuentaExtranjero"
               (change)="onToggle('cuentaExtranjero', $event)" />
        Cuentas en el extranjero
      </label>
    </div>

    <!-- Solo si cuentaExtranjero = true -->
    <ng-container *ngIf="view().cuentaExtranjero">
      <div class="col">
        <label>Tipo de moneda *</label>
        <input type="text"
               name="tipoMonedaExtranjera"
               [(ngModel)]="view().tipoMonedaExtranjera"
               [required]="true"
               maxlength="20" />
      </div>

      <div class="col">
        <label>Número de cuenta *</label>
        <input type="text"
               name="numeroCuentaExtranjero"
               [(ngModel)]="view().numeroCuentaExtranjero"
               [required]="true"
               maxlength="30" />
      </div>

      <div class="col">
        <label>Banco *</label>
        <input type="text"
               name="nombreBancoExtranjero"
               [(ngModel)]="view().nombreBancoExtranjero"
               [required]="true"
               maxlength="100" />
      </div>

      <div class="col">
        <label>Ciudad *</label>
        <input type="text"
               name="ciudadCuentaExtranjero"
               [(ngModel)]="view().ciudadCuentaExtranjero"
               [required]="true"
               maxlength="50" />
      </div>

      <div class="col">
        <label>País *</label>
        <input type="text"
               name="paisCuentaExtranjero"
               [(ngModel)]="view().paisCuentaExtranjero"
               [required]="true"
               maxlength="50" />
      </div>
    </ng-container>

  </div>

  <div class="actions">
    <button type="submit" class="btn btn--primary" [disabled]="guardando()">
      {{ mode() === 'new' ? 'Crear' : 'Guardar' }}
    </button>
    <button type="button" class="btn btn--ghost" (click)="goBack()" [disabled]="guardando()">
      Cancelar
    </button>
  </div>
</form>
